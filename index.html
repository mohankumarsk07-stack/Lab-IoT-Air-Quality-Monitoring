<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<!-- ✅ VERY IMPORTANT FOR MOBILE -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>AI IoT Air Quality Monitoring</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --card-bg:rgba(255,255,255,0.08);
  --green:#4ade80;
  --red:#fb7185;
}

/* ---------- BASE ---------- */
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:linear-gradient(135deg,#022c22,#064e3b);
  color:white;
  text-align:center;
  padding:10px;
}

h1{
  font-size:1.6rem;
  margin-bottom:15px;
}
h1 span{color:var(--green)}

.container{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
  max-width:1100px;
  margin:auto;
}

.box{
  background:var(--card-bg);
  border-radius:14px;
  padding:12px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
}

.box i{
  font-size:1.5rem;
  color:var(--green);
}

.value{
  font-size:1.4rem;
  font-weight:bold;
}

.status-safe{color:var(--green)}
.status-danger{color:var(--red)}

.btn{
  padding:10px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
  width:100%;
}

.btn-on{background:var(--red);color:white}
.btn-off{background:var(--green);color:#064e3b}

/* ---------- CHARTS ---------- */
.graphs{
  display:grid;
  grid-template-columns:1fr;
  gap:15px;
  margin-top:20px;
}

.chart-box{
  background:var(--card-bg);
  border-radius:14px;
  padding:10px;
  height:220px;
}

/* ---------- TABLET ---------- */
@media (min-width:600px){
  h1{font-size:1.8rem}
  .container{grid-template-columns:repeat(2,1fr)}
  .graphs{grid-template-columns:repeat(2,1fr)}
  .chart-box{height:240px}
}

/* ---------- DESKTOP ---------- */
@media (min-width:992px){
  body{padding:20px}
  h1{font-size:2rem}
  .container{grid-template-columns:repeat(5,1fr)}
  .graphs{grid-template-columns:repeat(3,1fr)}
  .chart-box{height:260px}
}
</style>
</head>

<body>

<h1>AI IoT <span>Air Quality Monitoring</span></h1>

<div class="container">
  <div class="box">
    <i class="fa-solid fa-smog"></i>
    <div>Air Quality</div>
    <div class="value"><span id="air">--</span></div>
  </div>

  <div class="box">
    <i class="fa-solid fa-temperature-high"></i>
    <div>Temperature</div>
    <div class="value"><span id="temp">--</span> °C</div>
  </div>

  <div class="box">
    <i class="fa-solid fa-droplet"></i>
    <div>Humidity</div>
    <div class="value"><span id="hum">--</span> %</div>
  </div>

  <div class="box">
    <i class="fa-solid fa-triangle-exclamation"></i>
    <div>Status</div>
    <div id="status" class="value">--</div>
  </div>

  <div class="box">
    <i class="fa-solid fa-fan"></i>
    <div>Motor</div>
    <button id="motorBtn" class="btn btn-off">OFF</button>
  </div>
</div>

<div class="graphs">
  <div class="chart-box"><canvas id="airChart"></canvas></div>
  <div class="chart-box"><canvas id="tempChart"></canvas></div>
  <div class="chart-box"><canvas id="humChart"></canvas></div>
</div>

<script>
const token="187Y4lnjBwTNEH7sMFmx1IRQJwB96Hin";
const getURL="https://blynk.cloud/external/api/get?token="+token;

let history={labels:[],air:[],temp:[],hum:[]};

function makeChart(id,color){
  return new Chart(document.getElementById(id),{
    type:'line',
    data:{labels:[],datasets:[{data:[],borderColor:color,tension:0.4}]},
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:true}}
    }
  });
}

const airChart=makeChart("airChart","#f87171");
const tempChart=makeChart("tempChart","#38bdf8");
const humChart=makeChart("humChart","#4ade80");

async function update(){
  const [v0,v1,v2,v3,v4]=await Promise.all([
    fetch(getURL+"&v0").then(r=>r.text()),
    fetch(getURL+"&v1").then(r=>r.text()),
    fetch(getURL+"&v2").then(r=>r.text()),
    fetch(getURL+"&v3").then(r=>r.text()),
    fetch(getURL+"&v4").then(r=>r.text())
  ]);

  air.innerText=v0;
  temp.innerText=v1;
  hum.innerText=v2;

  status.innerText=v3;
  status.className="value "+(v3==="DANGER"?"status-danger":"status-safe");

  motorBtn.innerText=v4==1?"ON":"OFF";
  motorBtn.className="btn "+(v4==1?"btn-on":"btn-off");

  const t=new Date().toLocaleTimeString();
  history.labels.push(t);
  history.air.push(v0);
  history.temp.push(v1);
  history.hum.push(v2);

  if(history.labels.length>20){
    history.labels.shift();
    history.air.shift();
    history.temp.shift();
    history.hum.shift();
  }

  airChart.data.labels=history.labels;
  airChart.data.datasets[0].data=history.air;
  airChart.update();

  tempChart.data.labels=history.labels;
  tempChart.data.datasets[0].data=history.temp;
  tempChart.update();

  humChart.data.labels=history.labels;
  humChart.data.datasets[0].data=history.hum;
  humChart.update();
}

setInterval(update,3000);
update();
</script>

</body>
</html>
