<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lab IoT Air Quality Monitoring</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin:0; font-family:Segoe UI;
  background:linear-gradient(135deg,#022c22,#064e3b);
  color:white; text-align:center; padding:20px;
}
h1 span{color:#4ade80}
.container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px; max-width:1000px; margin:auto;
}
.box{
  background:rgba(255,255,255,0.08);
  border-radius:15px; padding:15px;
}
.value{font-size:1.8rem;font-weight:bold}
.status-safe{color:#4ade80}
.status-danger{color:#fb7185}
.graphs{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:20px; margin-top:30px;
}
.chart-box{
  background:rgba(255,255,255,0.08);
  border-radius:15px; padding:15px; height:260px;
}
.btn{
  padding:10px;border:none;border-radius:10px;
  font-weight:bold;cursor:pointer;width:100%;
}
.btn-on{background:#fb7185;color:white}
.btn-off{background:#4ade80;color:#064e3b}
</style>
</head>

<body>

<h1>Lab IoT <span>Air Quality Monitoring</span></h1>

<div class="container">
  <div class="box">
    <div>Air Quality (MQ135)</div>
    <div class="value"><span id="air">--</span></div>
  </div>

  <div class="box">
    <div>Temperature</div>
    <div class="value"><span id="temp">--</span> Â°C</div>
  </div>

  <div class="box">
    <div>Humidity</div>
    <div class="value"><span id="hum">--</span> %</div>
  </div>

  <div class="box">
    <div>Status</div>
    <div id="status" class="value">--</div>
  </div>

  <div class="box">
    <div>Motor Status</div>
    <button id="motorBtn" class="btn btn-off">OFF</button>
  </div>
</div>

<div class="graphs">
  <div class="chart-box">
    <canvas id="airChart"></canvas>
  </div>
  <div class="chart-box">
    <canvas id="tempChart"></canvas>
  </div>
  <div class="chart-box">
    <canvas id="humChart"></canvas>
  </div>
</div>

<script>
const token = "187Y4lnjBwTNEH7sMFmx1IRQJwB96Hin";
const getURL = "https://blynk.cloud/external/api/get?token=" + token;

let history={labels:[],air:[],temp:[],hum:[]};

function makeChart(id,label,color){
 return new Chart(document.getElementById(id),{
  type:'line',
  data:{labels:[],datasets:[{data:[],borderColor:color,tension:0.4}]},
  options:{responsive:true,maintainAspectRatio:false,
    plugins:{legend:{display:false}},
    scales:{y:{beginAtZero:true}}
  }
 });
}

const airChart = makeChart("airChart","Air","#f87171");
const tempChart = makeChart("tempChart","Temp","#38bdf8");
const humChart  = makeChart("humChart","Hum","#4ade80");

async function update(){
 const [v0,v1,v2,v3,v4] = await Promise.all([
  fetch(getURL+"&v0").then(r=>r.text()),
  fetch(getURL+"&v1").then(r=>r.text()),
  fetch(getURL+"&v2").then(r=>r.text()),
  fetch(getURL+"&v3").then(r=>r.text()),
  fetch(getURL+"&v4").then(r=>r.text())
 ]);

 document.getElementById("air").innerText=v0;
 document.getElementById("temp").innerText=v1;
 document.getElementById("hum").innerText=v2;

 const status=document.getElementById("status");
 status.innerText=v3;
 status.className="value "+(v3==="DANGER"?"status-danger":"status-safe");

 const btn=document.getElementById("motorBtn");
 btn.innerText=v4==1?"ON":"OFF";
 btn.className="btn "+(v4==1?"btn-on":"btn-off");

 const t=new Date().toLocaleTimeString();
 history.labels.push(t);
 history.air.push(v0);
 history.temp.push(v1);
 history.hum.push(v2);

 if(history.labels.length>25){
  history.labels.shift();
  history.air.shift();
  history.temp.shift();
  history.hum.shift();
 }

 airChart.data.labels=history.labels;
 airChart.data.datasets[0].data=history.air;
 airChart.update();

 tempChart.data.labels=history.labels;
 tempChart.data.datasets[0].data=history.temp;
 tempChart.update();

 humChart.data.labels=history.labels;
 humChart.data.datasets[0].data=history.hum;
 humChart.update();
}

setInterval(update,3000);
update();
</script>
</body>
</html>
